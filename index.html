<!DOCTYPE html>
<html
    lang="en"
    class="h-full bg-white dark:bg-gray-950 text-black dark:text-white"
>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Chat</title>
        <link rel="stylesheet" href="style.tailwind.css" />
        <script src="main.ts" type="module"></script>
        <script src="login.ts" type="module"></script>
        <link rel="icon" href="icon.svg" type="image/svg+xml" />
        <link rel="preconnect" href="https://piukosdnirsgphzdyjan.supabase.co" />
    </head>
    <body class="h-full">
        <div class="container mx-auto p-4 h-full flex flex-col">
            <header class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold">Chat Application</h1>
                <nav class="flex items-center gap-4">
                    <button id="login-button" class="btn" type="button">
                        Login
                    </button>
                    <button
                        id="logout-button"
                        class="btn danger"
                        type="button"
                        hidden
                    >
                        Logout
                    </button>
                </nav>
            </header>
            <div
                id="chat"
                class="border border-gray-400 dark:border-gray-800 rounded-lg p-2 lg:h-96 not-lg:flex-auto overflow-y-scroll flex flex-col gap-2"
            >
                <!-- Chat messages will be appended here -->
            </div>
            <audio
                id="notification-sound"
                src="notif.mp3"
                preload="auto"
            ></audio>
            <form class="flex items-stretch mt-4 gap-1" id="chat-form">
                <fieldset disabled class="contents group">
                    <input
                        type="text"
                        class="input group-disabled:hidden"
                        placeholder="Type your message..."
                        required
                        autocomplete="off"
                        name="message"
                    />
                    <button class="btn group-disabled:hidden" type="submit">Send</button>
                    <small
                        class="text-gray-700 dark:text-white text-sm hidden group-disabled:block bg-gray-500/10 p-2 rounded-lg flex-1"
                    >
                        Please log in to send messages.
                    </small>
                </fieldset>
            </form>
        </div>
        <div
            id="you-need-a-username"
            class="mx-auto p-4 dialog flex flex-col items-stretch"
            hidden
        >
            <header class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold">Set Username</h1>
                <button
                    class="bg-none border-0 cursor-pointer close"
                    type="button"
                    title="Close"
                ></button>
            </header>
            <form
                class="flex items-stretch flex-col gap-1 flex-1"
                id="username-form"
            >
                <p>
                    You need to set a username before you can start chatting.
                    Please enter your desired username below.
                </p>
                <label
                    for="username-input"
                    class="text-gray-700 dark:text-gray-300"
                    >Username:</label
                >
                <input
                    type="text"
                    id="username-input"
                    class="input"
                    placeholder="Enter your username..."
                    required
                    minlength="3"
                    maxlength="20"
                    autocomplete="off"
                    name="username"
                    pattern="^[a-zA-Z0-9_]+$"
                />
                <div class="flex-auto"></div>
                <button class="btn" type="submit">Set Username</button>
                <div
                    id="username-error-message"
                    class="text-red-500"
                    hidden
                ></div>
            </form>
        </div>
        <div
            id="login-flow"
            class="mx-auto p-4 dialog flex flex-col items-stretch"
            hidden
        >
            <header class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold">Login</h1>
                <button
                    class="bg-none border-0 cursor-pointer close"
                    type="button"
                    title="Close"
                ></button>
            </header>
            <form
                class="flex items-stretch flex-col gap-1 flex-1"
                id="login-form-1"
            >
                <label
                    for="email-input"
                    class="text-gray-700 dark:text-gray-300"
                    >Email:</label>
                <input
                    type="email"
                    id="email-input"
                    class="input"
                    placeholder="Enter your email..."
                    required
                    autocomplete="email"
                    name="email"
                />
                <label
                    for="password-input"
                    class="text-gray-700 dark:text-gray-300"
                    >Password:</label>
                <input
                    type="password"
                    id="password-input"
                    class="input"
                    placeholder="Enter your password..."
                    required
                    autocomplete="current-password"
                    name="password"
                />
                <div class="flex-auto"></div>
                <div id="login-captcha" class="my-1 ml-1"></div>
                <div class="flex gap-1 justify-stretch">
                    <button class="btn flex-1" type="submit" value="login" >Login</button>
                    <button class="btn flex-1" type="submit" value="signup">Sign Up</button>
                </div>
            </form>
            <div
                id="login-loading"
                class="flex items-center justify-center mt-4 text-gray-500 dark:text-gray-400"
                hidden
            >
                <svg
                    class="animate-spin h-5 w-5"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                >
                    <circle
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                        stroke-dasharray="30 1400"
                    />
                </svg>
                <span class="ml-2">Loading...</span>
            </div>
            <div
                id="login-complete"
                class="flex items-center flex-col gap-1 flex-1"
                hidden
            >
                <svg
                    viewBox="0 0 512 512"
                    xmlns="http://www.w3.org/2000/svg"
                    id="login-complete-svg"
                    alt="Checkmark"
                    class="w-32 h-32 mx-auto mb-4"
                >
                    <g
                        fill="none"
                        class="stroke-current text-emerald-500"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="20"
                    >
                        <path
                            d="m472.81 256a216.81 216.81 0 0 1-216.81 216.81 216.81 216.81 0 0 1-216.81-216.81 216.81 216.81 0 0 1 216.81-216.81 216.81 216.81 0 0 1 216.81 216.81z"
                        />
                        <path d="m165.38 283.06 71.252 68.199 109.99-190.51" />
                    </g>
                </svg>
                <h2 class="text-2xl font-bold mb-4">Login Successful</h2>
                <p class="text-gray-700 dark:text-gray-300" id="login-complete-message" hidden>
                    You have successfully logged in. You can now start chatting.
                </p>
                <p class="text-gray-700 dark:text-gray-300" id="login-complete-message-need-username">
                    You have successfully logged in. But you need to set a
                    username before you can start chatting.
                </p>
                <div class="flex-auto"></div>
                <button id="login-complete-continue" class="btn" type="button">
                    Continue
                </button>
                <button id="back-to-login" class="btn danger" type="button">
                    Back to Login
                </button>
            </div>
            <div
                id="login-error-message"
                class="text-red-500"
                hidden
            ></div>
        </div>
        <div
            id="dialog-bg"
            class="fixed inset-0 bg-neutral-800/50 z-40 hidden backdrop-blur-xs"
        ></div>
        <div
            id="loading-overlay"
            class="fixed inset-0 bg-neutral-300/90 dark:bg-neutral-900/90 z-100 flex flex-col gap-2 items-center justify-center text-neutral-800 dark:text-white backdrop-blur-sm font-semibold"
        >
            <div class="flex items-center gap-2">
                <svg
                    class="animate-spin h-5 w-5"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                >
                    <circle
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                        stroke-dasharray="30 1400"
                    />
                </svg>
                <span>Loading...</span>
            </div>
            <div id="loading-message" class="text-gray-700 dark:text-gray-400 font-normal"></div>
            <noscript class="text-red-500">
                JavaScript is required for this application to function properly. Please enable JavaScript in your browser settings.
            </noscript>
        </div>
    </body>
</html>
